<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Trendspy ‚Äî Product Management</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
:root{
  --bg:#0b0f1e;
  --accent:#ec4899;
  --accent2:#8b5cf6;
  --muted:#94a3b8;
  --glass:rgba(255,255,255,0.05);
  --success:#22c55e;
  font-family:'Poppins',sans-serif;
  color:#e6eef8;
}
body{
  margin:0;
  background:radial-gradient(circle at top,#1a1035,#0b0f1e 80%);
  display:flex;flex-direction:column;align-items:center;
  min-height:100vh;
  padding:30px 20px;
}
header{display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:20px;}
.logo{
  width:46px;height:46px;border-radius:12px;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  display:flex;align-items:center;justify-content:center;
  font-weight:700;font-size:20px;color:#0a0a0a;
}
h1{
  font-size:28px;margin:0;
  background:linear-gradient(90deg,var(--accent),var(--accent2));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  font-weight:700;
}
.container{
  background:rgba(255,255,255,0.05);
  border-radius:16px;
  padding:24px;
  width:95%;max-width:900px;
  box-shadow:0 0 25px rgba(236,72,153,0.15);
  backdrop-filter:blur(10px);
  border:1px solid rgba(255,255,255,0.08);
}
fieldset{
  border:1px solid rgba(255,255,255,0.08);
  border-radius:14px;
  margin-top:16px;
  background:rgba(255,255,255,0.03);
  padding:16px;
  transition:.3s;
}
fieldset:hover{box-shadow:0 0 10px rgba(236,72,153,0.15);}
legend{color:var(--accent);padding:0 8px;font-weight:600;}
input{
  width:100%;padding:10px;border-radius:8px;
  margin:5px 0 10px 0;border:1px solid rgba(255,255,255,0.1);
  background:rgba(255,255,255,0.07);color:#fff;
}
input:focus{outline:none;border-color:var(--accent);}
input[type=file]{border:1px dashed rgba(255,255,255,0.2);padding:8px;color:#a0aec0;background:rgba(255,255,255,0.03);text-align:center;}
button{
  padding:10px 16px;border-radius:10px;border:none;font-weight:600;cursor:pointer;margin-top:5px;transition:.3s;
}
button.primary{
  background:linear-gradient(90deg,var(--accent),var(--accent2));
  color:#fff;box-shadow:0 0 10px rgba(236,72,153,0.3);
}
button.primary:hover{filter:brightness(1.2);transform:translateY(-1px);}
button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.15);color:#e6eef8;}
table{width:100%;border-collapse:collapse;margin-top:20px;font-size:14px;}
th,td{padding:10px;text-align:left;}
th{border-bottom:1px solid rgba(255,255,255,0.1);color:var(--accent);}
tr:hover{background:rgba(255,255,255,0.05);}
td button{font-size:12px;padding:5px 10px;}
#bulkDeleteBtn{display:none;margin-top:8px;}
#denied{color:#ef4444;font-weight:600;margin-top:40px;text-align:center;}
footer{margin-top:30px;color:var(--muted);font-size:12px;text-align:center;}
.toast{
  position:fixed;bottom:20px;right:20px;background:rgba(0,0,0,0.85);
  padding:10px 14px;border-radius:10px;font-size:13px;color:white;
  box-shadow:0 0 15px rgba(236,72,153,0.4);
  animation:fade 1.2s ease forwards;
}
@keyframes fade{
  0%{opacity:0;transform:translateY(10px);}
  20%{opacity:1;}
  80%{opacity:1;}
  100%{opacity:0;transform:translateY(10px);}
}
</style>
</head>

<body>
<header>
  <div class="logo">T</div>
  <h1>Trendspy Product Manager</h1>
</header>

<div class="container" id="main">
  <p style="color:var(--muted)">Manage your store inventory ‚Äî Add, Import, Update or Delete Products.</p>

  <!-- Add Product -->
  <fieldset>
    <legend>ü™Ñ Add / Edit Product</legend>
    <form id="productForm">
      <input type="hidden" id="pid">
      <label>Title:</label><input id="title" required>
      <label>Category:</label><input id="category" placeholder="e.g. Hoodies / T-Shirts">
      <label>Price (‚Çπ):</label><input id="price" type="number" required>
      <label>Discount Price (‚Çπ):</label><input id="discountPrice" type="number">
      <label>Image URL:</label><input id="image" placeholder="https://picsum.photos/400">
      <button type="submit" class="primary">üíæ Save Product</button>
    </form>
  </fieldset>

  <!-- Excel Import -->
  <fieldset>
    <legend>üì• Import from Excel</legend>
    <input type="file" id="fileInput" accept=".xlsx,.xls">
    <button id="importBtn" class="primary">Import Excel</button>
  </fieldset>

  <div id="productTable"></div>
  <button id="bulkDeleteBtn" class="ghost">üóë Delete Selected Products</button>
  <button class="ghost" style="margin-top:10px" onclick="window.location.href='shop.html'">‚¨Ö Back to Dashboard</button>
</div>

<div id="denied" style="display:none">üö´ Access Denied. Please open this page from Admin Dashboard.</div>
<footer>¬© 2025 Trendspy | Secure Product Manager</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
import { getDatabase, ref, set, get, child, remove, update } 
  from "https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "trendspy-3ba6d.firebaseapp.com",
  databaseURL: "https://trendspy-3ba6d-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "trendspy-3ba6d",
  storageBucket: "trendspy-3ba6d.appspot.com",
  messagingSenderId: "1064401414241",
  appId: "YOUR_APP_ID"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const el=id=>document.getElementById(id);
const urlParams=new URLSearchParams(window.location.search);
const authKey=urlParams.get('auth');

if(authKey!=='trendspy-admin'){
  el('main').style.display='none';
  el('denied').style.display='block';
  throw new Error('Unauthorized Access');
}

let products=[];
function toast(msg){
  const t=document.createElement('div');
  t.className='toast';t.textContent=msg;
  document.body.appendChild(t);
  setTimeout(()=>t.remove(),1800);
}

/* Load products from Firebase */
async function loadProducts(){
  const snapshot = await get(child(ref(db),'products'));
  products = snapshot.exists() ? Object.values(snapshot.val()) : [];
  renderTable();
}

/* Save product to Firebase */
async function saveProduct(p){
  await set(ref(db, 'products/'+p.id), p);
}

/* Render table */
function renderTable(){
  const c=el('productTable');
  if(!products.length){
    c.innerHTML='<p style="color:var(--muted)">No products available yet.</p>';
    el('bulkDeleteBtn').style.display='none';return;
  }
  c.innerHTML=`<table>
  <thead><tr><th><input type="checkbox" id="selectAll"></th><th>Image</th><th>Title</th><th>Category</th><th>Price</th><th>Discount</th><th>Actions</th></tr></thead>
  <tbody>${products.map(p=>`
    <tr>
      <td><input type="checkbox" class="select" data-id="${p.id}"></td>
      <td><img src="${p.image}" width="50" height="50" style="border-radius:6px"></td>
      <td>${p.title}</td>
      <td>${p.category}</td>
      <td style="color:var(--success)">‚Çπ${p.price}</td>
      <td>${p.discountPrice?`‚Çπ${p.discountPrice}`:'‚Äî'}</td>
      <td>
        <button class='ghost' onclick="editProduct(${p.id})">‚úè Edit</button>
        <button class='ghost' onclick="deleteProduct(${p.id})">üóë Delete</button>
      </td>
    </tr>`).join('')}
  </tbody></table>`;
  el('bulkDeleteBtn').style.display='block';
  el('selectAll').onchange=e=>{
    document.querySelectorAll('.select').forEach(cb=>cb.checked=e.target.checked);
  };
}

/* Add / Edit Product */
el('productForm').onsubmit=async e=>{
  e.preventDefault();
  const pid=el('pid').value;
  const newProduct={
    id:pid?parseInt(pid):Date.now(),
    title:el('title').value.trim(),
    category:el('category').value.trim()||'General',
    price:parseInt(el('price').value)||0,
    discountPrice:parseInt(el('discountPrice').value)||0,
    image:el('image').value.trim()||'https://picsum.photos/400'
  };
  await saveProduct(newProduct);
  toast(pid?'‚úÖ Product updated':'‚úÖ Product added');
  el('productForm').reset();el('pid').value='';
  loadProducts();
};

window.editProduct=id=>{
  const p=products.find(x=>x.id===id);
  if(!p)return;
  el('pid').value=p.id;
  el('title').value=p.title;
  el('category').value=p.category;
  el('price').value=p.price;
  el('discountPrice').value=p.discountPrice;
  el('image').value=p.image;
  toast('‚úè Edit mode active');
};

window.deleteProduct=async id=>{
  if(!confirm('Delete this product?'))return;
  await remove(ref(db,'products/'+id));
  toast('üóë Product deleted');
  loadProducts();
};

/* Bulk Delete */
el('bulkDeleteBtn').onclick=async ()=>{
  const selected=[...document.querySelectorAll('.select:checked')].map(cb=>cb.dataset.id);
  if(!selected.length)return toast('No products selected');
  if(!confirm('Delete selected products?'))return;
  for(const id of selected){await remove(ref(db,'products/'+id));}
  toast('üóë Selected products deleted');
  loadProducts();
};

/* Import Excel */
el('importBtn').onclick=()=>{
  const file=el('fileInput').files[0];
  if(!file)return alert('Please select an Excel file first!');
  const reader=new FileReader();
  reader.onload=async e=>{
    const wb=XLSX.read(new Uint8Array(e.target.result),{type:'array'});
    const sheet=wb.Sheets[wb.SheetNames[0]];
    const json=XLSX.utils.sheet_to_json(sheet);
    for(let i=0;i<json.length;i++){
      const p=json[i];
      const newP={
        id:Date.now()+i,
        title:p.Title||p.name||p.Product||`Item ${i+1}`,
        price:parseInt(p.Price)||0,
        discountPrice:parseInt(p.DiscountPrice)||0,
        category:p.Category||'General',
        image:p.Image||`https://picsum.photos/400?random=${i+1}`
      };
      await saveProduct(newP);
    }
    toast('üì• Imported successfully!');
    loadProducts();
  };
  reader.readAsArrayBuffer(file);
};

loadProducts();
</script>
</body>
</html>
