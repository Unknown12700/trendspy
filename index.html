<!doctype html> 
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Trendspy ‚Äî Fashion that Inspires</title>

<!-- Libraries -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<style>
:root {
  --bg:#0b0f1e;
  --card:rgba(255,255,255,0.06);
  --accent:#ec4899;
  --accent2:#8b5cf6;
  --muted:#94a3b8;
  --success:#22c55e;
  --danger:#ef4444;
  --text:#f5f5f5;
  font-family:'Poppins',sans-serif;
}

/* Light Mode */
body.light {
  --bg:#f8fafc;
  --card:#ffffff;
  --text:#111827;
  --muted:#4b5563;
  background:linear-gradient(180deg,#f9fafb,#e5e7eb);
  color:var(--text);
}

/* Common Styling */
body{
  margin:0;
  background:radial-gradient(circle at top,#1a1035,#0b0f1e 85%);
  overflow-x:hidden;
  color:var(--text);
  transition:background 0.4s ease, color 0.4s ease;
}
h1,h2,h3,h4{margin:0;}
a{text-decoration:none;color:inherit;}

header{
  position:sticky;top:0;z-index:1000;
  background:rgba(0,0,0,0.65);
  backdrop-filter:blur(10px);
  display:flex;justify-content:space-between;align-items:center;
  padding:14px 24px;
  box-shadow:0 0 15px rgba(0,0,0,0.4);
}
body.light header{background:rgba(255,255,255,0.8);box-shadow:0 0 15px rgba(0,0,0,0.1);}
.logo{
  font-size:26px;font-weight:700;
  background:linear-gradient(90deg,var(--accent),var(--accent2));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
}
.nav-links a{margin:0 10px;color:var(--muted);font-weight:500;}
.nav-links a:hover{color:var(--accent);}

nav{display:flex;align-items:center;gap:8px;flex-wrap:wrap;}
nav button{padding:8px 14px;border:none;border-radius:10px;cursor:pointer;font-weight:600;}
.primary{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;box-shadow:0 0 8px rgba(236,72,153,0.3);}
.ghost{background:transparent;border:1px solid rgba(255,255,255,0.15);color:var(--muted);}
body.light .ghost{border:1px solid rgba(0,0,0,0.2);color:var(--text);}

/* Theme Toggle */
.theme-toggle{
  display:flex;align-items:center;gap:6px;cursor:pointer;font-size:13px;font-weight:600;
}
.theme-toggle input{display:none;}
.toggle-slider{
  width:36px;height:18px;background:#555;border-radius:10px;position:relative;transition:.3s;
}
.toggle-slider::before{
  content:"";position:absolute;width:14px;height:14px;top:2px;left:2px;background:white;border-radius:50%;transition:.3s;
}
input:checked + .toggle-slider{background:#ec4899;}
input:checked + .toggle-slider::before{transform:translateX(18px);}

/* Hero */
.hero{text-align:center;padding:100px 20px 60px;}
.hero h1{font-size:42px;font-weight:700;background:linear-gradient(90deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.hero p{color:var(--muted);font-size:18px;}
.hero button{margin-top:18px;}

/* Shop Layout */
#shop{display:grid;grid-template-columns:1fr 320px;gap:20px;padding:40px 20px;}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:20px;}
.card{background:var(--card);padding:16px;border-radius:14px;transition:.3s;}
.card:hover{transform:translateY(-3px);box-shadow:0 0 10px rgba(236,72,153,0.3);}
.thumb img{width:100%;border-radius:12px;height:220px;object-fit:cover;}
.card h4{margin:10px 0 5px;}
aside{background:var(--card);padding:16px;border-radius:14px;transition:0.3s;}

/* About */
.about{padding:80px 20px;text-align:center;background:rgba(255,255,255,0.03);}
body.light .about{background:#f3f4f6;}
.about h2{font-size:32px;font-weight:700;background:linear-gradient(90deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.about p{color:var(--muted);max-width:700px;margin:auto;font-size:16px;line-height:1.6;}

/* Orders */
#orders{padding:40px 20px;}
.order-card{background:var(--card);padding:16px;margin-bottom:12px;border-radius:14px;box-shadow:0 0 10px rgba(255,255,255,0.05);transition:0.3s;}
.status{font-weight:600;}
.status.pending{color:#fbbf24;}
.status.delivered{color:var(--success);}
.status.cancelled{color:var(--danger);}
.remark{color:#f87171;font-size:13px;margin-top:4px;}
.tracking-bar{display:flex;justify-content:space-between;margin-top:10px;}
.step{text-align:center;flex:1;}
.circle{width:12px;height:12px;border-radius:50%;margin:auto;margin-bottom:5px;background:var(--muted);}
.step.done .circle{background:var(--success);}
.step.active .circle{background:var(--accent);}
.cancel-btn{
  margin-top:8px;padding:6px 12px;border-radius:8px;
  background:linear-gradient(90deg,#ef4444,#dc2626);
  color:white;border:none;cursor:pointer;font-weight:600;
}

/* Footer */
footer{background:rgba(255,255,255,0.03);color:var(--muted);text-align:center;padding:20px;margin-top:20px;}
body.light footer{background:#f9fafb;color:var(--muted);}

/* Modals */
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.7);display:none;align-items:center;justify-content:center;z-index:999;}
.modal .box{background:white;color:black;padding:22px;border-radius:12px;text-align:center;width:90%;max-width:340px;}
.modal input{width:90%;margin:8px;padding:8px;border-radius:8px;border:1px solid #ccc;}
</style>
</head>

<body>
<header>
  <div class="logo">Trendspy</div>
  <div class="nav-links">
    <a href="#home">Home</a>
    <a href="#shop">Shop</a>
    <a href="#orders">Orders</a>
    <a href="#about">About</a>
  </div>
  <nav>
    <button id="login-btn" class="primary">Customer Login</button>
    <button id="admin-login-btn" class="ghost">Admin Login</button>
    <div class="theme-toggle">
      <label>
        <input type="checkbox" id="themeSwitch">
        <div class="toggle-slider"></div>
      </label>
      <span id="themeLabel">Dark</span>
    </div>
  </nav>
</header>

<section id="home" class="hero">
  <h1>Style that Inspires Confidence ‚ú®</h1>
  <p>Discover your unique look with Trendspy ‚Äî India's premium fashion destination.</p>
  <button class="primary" onclick="document.getElementById('shop').scrollIntoView({behavior:'smooth'})">Explore Collection</button>
</section>

<section id="shop">
  <div>
    <h2>üõç Latest Collections</h2>
    <div id="products" class="grid">Loading products...</div>
  </div>
  <aside>
    <h3>üõí Your Cart <span id="cart-count">(0)</span></h3>
    <div id="cart-list" style="min-height:60px;">Empty</div><hr>
    <p><b>Subtotal:</b> <span id="subtotal">‚Çπ0</span></p>
    <p><b>Shipping:</b> ‚Çπ49</p>
    <p><b>Total:</b> <span id="total">‚Çπ0</span></p>
    <button class="primary" id="checkout">Proceed to Checkout</button>
  </aside>
</section>

<section id="orders">
  <h2>üì¶ My Orders</h2>
  <div id="orders-list">No orders yet.</div>
</section>

<section id="about" class="about">
  <h2>About Trendspy</h2>
  <p>Trendspy is a fashion-forward brand built to inspire individuality. Our mission is to empower everyone to express their true selves through style. From streetwear to luxury looks, Trendspy merges comfort and creativity for every occasion.</p>
</section>

<footer><p>¬© 2025 Trendspy ‚Äî Designed with üíñ for Fashion Enthusiasts</p></footer>

<!-- Login Modals -->
<div class="modal" id="login-modal">
  <div class="box">
    <h3>Customer Login üëó</h3>
    <input id="cust-name" placeholder="Your Name">
    <input id="cust-contact" placeholder="Phone (+91XXXXXXXXXX)">
    <button class="primary" id="cust-login">Login</button>
    <button id="close-login">Close</button>
  </div>
</div>

<div class="modal" id="admin-modal">
  <div class="box">
    <h3>Admin Login üîê</h3>
    <input id="admin-user" placeholder="Username">
    <input id="admin-pass" placeholder="Password" type="password">
    <button class="primary" id="admin-login">Login</button>
    <button id="close-admin">Close</button>
  </div>
</div>

<!-- Firebase Logic -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
import { getDatabase, ref, set, get, child, update, onValue } 
  from "https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "trendspy-3ba6d.firebaseapp.com",
  databaseURL: "https://trendspy-3ba6d-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "trendspy-3ba6d",
  storageBucket: "trendspy-3ba6d.appspot.com",
  messagingSenderId: "1064401414241",
  appId: "YOUR_APP_ID"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

window.addEventListener("DOMContentLoaded", async ()=>{
  const el=id=>document.getElementById(id);

  /* === Theme Toggle === */
  const themeSwitch = el('themeSwitch');
  const themeLabel = el('themeLabel');
  if(localStorage.getItem('theme')==='light'){
    document.body.classList.add('light');
    themeSwitch.checked = true;
    themeLabel.textContent = 'Light';
  }
  themeSwitch.onchange = ()=>{
    document.body.classList.toggle('light', themeSwitch.checked);
    themeLabel.textContent = themeSwitch.checked ? 'Light' : 'Dark';
    localStorage.setItem('theme', themeSwitch.checked ? 'light' : 'dark');
  };

  /* === Existing logic continues === */
  let user=JSON.parse(localStorage.getItem('user')||'null');
  let cart=JSON.parse(localStorage.getItem('cart')||'{}');
  let orders=[],products=[];
  const stages=['Pending','Accepted','Out for Delivery','Delivered'];

  function toast(m){alert(m);}
  function isValidPhone(p){return /^(\+\d{1,3}\d{7,14}|\d{10})$/.test(p);}

  async function loadProducts(){
    const snapshot=await get(child(ref(db),'products'));
    if(snapshot.exists()) products=Object.values(snapshot.val());
    else products=[
      {id:1,title:"Men‚Äôs Denim Jacket",price:1999,image:"https://images.unsplash.com/photo-1521334884684-d80222895322"},
      {id:2,title:"Women‚Äôs Floral Dress",price:1399,image:"https://images.unsplash.com/photo-1520975922372-65b1f95a83ed"},
      {id:3,title:"White Shirt",price:799,image:"https://images.unsplash.com/photo-1598033125834-6fbd321c1f90"}
    ];
    renderProducts();
  }

  function renderProducts(){
    el('products').innerHTML=products.map(p=>`
      <div class="card">
        <div class="thumb"><img src="${p.image}" alt="${p.title}"></div>
        <h4>${p.title}</h4>
        <p>‚Çπ${p.price}</p>
        <button class="primary" onclick="addToCart(${p.id},'${p.title}',${p.price},'${p.image}')">Add to Cart</button>
      </div>`).join('');
  }

  window.addToCart=(id,title,price,image)=>{
    if(!user)return toast("Please login first!");
    if(!cart[id])cart[id]={id,title,price,image,qty:0};
    cart[id].qty++;
    localStorage.setItem('cart',JSON.stringify(cart));
    renderCart();
  };

  function renderCart(){
    let html='',sub=0;const ids=Object.keys(cart);
    if(!ids.length){el('cart-list').innerHTML='Empty';el('cart-count').textContent='(0)';el('subtotal').textContent='‚Çπ0';el('total').textContent='‚Çπ0';return;}
    ids.forEach(i=>{let it=cart[i];sub+=it.price*it.qty;html+=`${it.title} √ó ${it.qty}<br>`;});
    el('cart-list').innerHTML=html;
    el('cart-count').textContent=`(${ids.length})`;
    el('subtotal').textContent='‚Çπ'+sub;
    el('total').textContent='‚Çπ'+(sub+49);
  }

  el('checkout').onclick=()=>{
    if(!user)return toast("Please login first!");
    if(!Object.keys(cart).length)return toast("Cart is empty!");
    const currentOrder={
      id:'ORD'+Date.now(),
      user:user.name,
      contact:user.contact,
      items:cart,
      total:el('total').textContent,
      status:'Pending',
      trackingStage:0,
      paymentStatus:'Unpaid',
      paymentMethod:'',
      remark:'',
      ts:new Date().toLocaleString()
    };
    localStorage.setItem('currentOrder',JSON.stringify(currentOrder));
    window.location.href='payment.html';
  };

  function renderOrders(){
    const c=el('orders-list');
    if(!orders.length)return c.innerHTML='<p>No orders yet.</p>';
    c.innerHTML='';
    orders.slice().reverse().forEach(o=>{
      let trackHTML='<div class="tracking-bar">';
      stages.forEach((s,i)=>{
        let cls='step';
        if(i<o.trackingStage)cls+=' done';
        else if(i===o.trackingStage)cls+=' active';
        trackHTML+=`<div class="${cls}"><div class="circle"></div><span>${s}</span></div>`;
      });
      trackHTML+='</div>';

      const recBtn=(o.status==='Delivered')?`<button class="primary" onclick="downloadReceipt('${o.id}')">üßæ Download Receipt</button>`:'';
      const cancelBtn=(o.status==='Pending'||o.status==='Accepted')?`<button class="cancel-btn" onclick="cancelOrder('${o.id}')">Cancel Order</button>`:'';
      c.innerHTML+=`
        <div class="order-card">
          <b>${o.id}</b> ‚Äî ${o.ts}<br>
          Status: <span class="status ${o.status.toLowerCase()}">${o.status}</span><br>
          Total: <b>${o.total}</b>
          ${o.remark ? `<div class="remark">üìù Remark: ${o.remark}</div>` : ''}
          ${trackHTML}
          <div style="margin-top:8px;">${recBtn}${cancelBtn}</div>
        </div>`;
    });
  }

  window.cancelOrder = async (id)=>{
    const o=orders.find(x=>x.id===id);
    if(!o)return;
    if(o.status==='Out for Delivery'||o.status==='Delivered')
      return toast("You can't cancel once it's out for delivery.");
    if(confirm("Cancel this order?")){
      o.status='Cancelled'; o.remark='Cancelled by Customer'; o.trackingStage=0;
      await update(ref(db,`orders/${user.contact}/${id}`),o);
      toast("Order cancelled successfully!");
    }
  };

  function listenToOrderUpdates(){
    if(!user)return;
    const refUser=ref(db,`orders/${user.contact}`);
    onValue(refUser,snapshot=>{
      if(snapshot.exists()){orders=Object.values(snapshot.val());renderOrders();}
      else{orders=[];renderOrders();}
    });
  }

  window.downloadReceipt=async(id)=>{
    const o=orders.find(x=>x.id===id); if(!o)return;
    if(o.status!=='Delivered')return toast("Receipt available only after delivery.");
    const temp=document.createElement('div');
    temp.innerHTML=`
      <div style="font-family:sans-serif;padding:20px;background:white;color:black;width:260px">
        <h3 style="text-align:center;color:#ec4899;">Trendspy Receipt</h3>
        <hr><b>Order ID:</b> ${o.id}<br>
        <b>Name:</b> ${o.user}<br>
        <b>Total:</b> ${o.total}<br>
        <b>Status:</b> ${o.status}<br>
        <b>Date:</b> ${o.ts}<br><hr>
        <b>Items:</b><br>${Object.values(o.items).map(i=>`${i.title} √ó ${i.qty}`).join('<br>')}
        <hr><small>Thank you for shopping with Trendspy!</small>
      </div>`;
    document.body.appendChild(temp);
    const canvas=await html2canvas(temp);
    const pdf=new jspdf.jsPDF();
    const img=canvas.toDataURL('image/png');
    const w=pdf.internal.pageSize.getWidth();
    const h=(canvas.height*w)/canvas.width;
    pdf.addImage(img,'PNG',0,0,w,h);
    pdf.save(`Receipt_${o.id}.pdf`);
    temp.remove();toast("Receipt downloaded.");
  }

  el('login-btn').onclick=()=>{
    if(user){
      if(confirm("Logout?")){user=null;localStorage.removeItem('user');el('login-btn').textContent='Customer Login';orders=[];renderOrders();}
    } else el('login-modal').style.display='flex';
  };
  el('close-login').onclick=()=>el('login-modal').style.display='none';
  el('cust-login').onclick=()=>{
    const n=el('cust-name').value.trim(), c=el('cust-contact').value.trim();
    if(!n)return toast("Enter name!"); if(!isValidPhone(c))return toast("Invalid phone!");
    user={name:n,contact:c};localStorage.setItem('user',JSON.stringify(user));
    el('login-modal').style.display='none';el('login-btn').textContent='Logout';
    toast(`Welcome ${n}!`);listenToOrderUpdates();
  };

  const ADMIN={user:"admin",pass:"trendspy123"};
  el('admin-login-btn').onclick=()=>el('admin-modal').style.display='flex';
  el('close-admin').onclick=()=>el('admin-modal').style.display='none';
  el('admin-login').onclick=()=>{
    const u=el('admin-user').value.trim(), p=el('admin-pass').value.trim();
    if(u===ADMIN.user && p===ADMIN.pass){
      toast("Redirecting to Admin Dashboard...");
      setTimeout(()=>window.location.href='shop.html',700);
    }else toast("Invalid admin credentials!");
  };

  if(user){el('login-btn').textContent='Logout';listenToOrderUpdates();}
  loadProducts();renderCart();
});
</script>
</body>
</html>
""